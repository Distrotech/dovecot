noinst_LIBRARIES = libsql.a

sql_drivers = @sql_drivers@

AM_CPPFLAGS = \
	-I$(top_srcdir)/src/lib \
	$(SQL_CFLAGS)

dist_sources = \
	driver-mysql.c \
	driver-pgsql.c \
	driver-sqlite.c \
	sql-api.c

libsql_a_SOURCES = \
	$(dist_sources) \
	sql-drivers-register.c

headers = \
	sql-api.h \
	sql-api-private.h

if INSTALL_HEADERS
  pkginc_libdir=$(pkgincludedir)/src/lib-sql
  pkginc_lib_HEADERS = $(headers)
else
  noinst_HEADERS = $(headers)
endif

sql-drivers-register.c: Makefile
	rm -f $@
	echo '/* this file automatically generated by Makefile */' >$@
	echo '#include "lib.h"' >>$@
	echo '#include "sql-api.h"' >>$@
	for i in $(sql_drivers) null; do \
	  if [ "$${i}" != "null" ]; then \
	        echo "extern struct sql_db driver_$${i}_db;" >>$@ ; \
	  fi \
	done
	echo 'void sql_drivers_register_all(void) {' >>$@
	for i in $(sql_drivers) null; do \
	  if [ "$${i}" != "null" ]; then \
	        echo "sql_driver_register(&driver_$${i}_db);" >>$@ ; \
	  fi \
	done
	echo '}' >>$@

DISTFILES = $(DIST_COMMON) $(dist_sources) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)

distclean-generic:
	rm -f Makefile sql-drivers-register.c
